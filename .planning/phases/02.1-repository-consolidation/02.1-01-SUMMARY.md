---
phase: 02.1-repository-consolidation
plan: 01
subsystem: infra
tags: [chezmoi, git, age, xdg]

# Dependency graph
requires:
  - phase: 01-repository-foundation-safety
    provides: chezmoi source at ~/.local/share/chezmoi with age encryption
  - phase: 02-package-management-tool-inventory
    provides: package lists and planning history in home repo
provides:
  - Unified git repository at ~/.dotfiles containing all chezmoi files and .planning/ history
  - Chezmoi configured to use ~/.dotfiles as source directory
  - Age encryption key at XDG-compliant path ~/.config/age/keys.txt
affects: [all-future-phases]

# Tech tracking
tech-stack:
  added: []
  patterns:
    - "Single unified repository pattern for dotfiles management"
    - "XDG Base Directory specification for config files"

key-files:
  created:
    - ~/.config/chezmoi/chezmoi.toml
    - ~/.config/age/keys.txt
  modified:
    - ~/.dotfiles/.chezmoi.toml.tmpl
    - ~/.dotfiles/.git/ (merged history)

key-decisions:
  - "Chezmoi repo is primary - keeps commit hashes unchanged"
  - "Home repo .planning/ commits merged via merge commit with --allow-unrelated-histories"
  - "Use main branch (chezmoi repo branch) as primary branch"
  - "Removed duplicate .dotfiles/.planning/ paths from home repo after merge"
  - "Relocated age key to ~/.config/age/keys.txt (XDG-compliant path)"

patterns-established:
  - "Global chezmoi config in ~/.config/chezmoi/chezmoi.toml specifies sourceDir"
  - "Age key at XDG path with 700/600 permissions for security"
  - "Template .chezmoi.toml.tmpl references age key location"

# Metrics
duration: 2min
completed: 2026-02-10
---

# Phase 02.1 Plan 01: Repository Consolidation Summary

**Unified split git repositories into single source at ~/.dotfiles with 32 commits of merged history, chezmoi configured for new location, age key relocated to XDG-compliant path**

## Performance

- **Duration:** 2 min
- **Started:** 2026-02-10T20:08:45Z
- **Completed:** 2026-02-10T20:10:53Z
- **Tasks:** 2
- **Files modified:** 3

## Accomplishments
- Merged chezmoi source (from ~/.local/share/chezmoi) and home repo (from ~/) into unified repository at ~/.dotfiles
- Unified git history shows 32 commits from both repositories (chezmoi work + planning docs)
- Configured chezmoi to use ~/.dotfiles as source directory via global config
- Relocated age encryption key from ~/key.txt to ~/.config/age/keys.txt (XDG-compliant)
- Verified encryption/decryption works with relocated key

## Task Commits

Each task was committed atomically:

1. **Task 1: Move chezmoi source to ~/.dotfiles and merge home repo history** - `ab7a396` (merge)
   - Moved chezmoi source from ~/.local/share/chezmoi to ~/.dotfiles
   - Merged home repo history with --allow-unrelated-histories
   - Resolved conflicts by keeping chezmoi repo versions of .planning/ files
   - Removed duplicate .dotfiles/.planning/ paths from home repo

2. **Task 2: Configure chezmoi source directory and relocate age key** - `e33e7f8` (chore)
   - Created global chezmoi config at ~/.config/chezmoi/chezmoi.toml
   - Relocated age key to ~/.config/age/keys.txt with proper permissions (700/600)
   - Updated .chezmoi.toml.tmpl to reference new key location

## Files Created/Modified
- `~/.dotfiles/.git/` - Unified git repository with merged history from both repos
- `~/.dotfiles/.chezmoi.toml.tmpl` - Updated identity path to ~/.config/age/keys.txt
- `~/.config/chezmoi/chezmoi.toml` - Global chezmoi config specifying sourceDir and age identity
- `~/.config/age/keys.txt` - Age encryption key at XDG-compliant location

## Decisions Made
- Chezmoi repo was treated as primary - its commit hashes remain unchanged
- Home repo .planning/ commits were merged in via merge commit (not rebased)
- Kept chezmoi repo's versions of .planning/ROADMAP.md and .planning/STATE.md during conflict resolution
- Removed duplicate .dotfiles/.planning/ paths that came from home repo's nested tracking
- Used `main` branch (from chezmoi repo) as the primary branch going forward
- Relocated age key to XDG-compliant path (~/.config/age/) instead of keeping at ~/key.txt

## Deviations from Plan

None - plan executed exactly as written. Merge conflicts were anticipated and resolved as specified in the plan.

## Issues Encountered

None - merge process completed smoothly with expected conflicts on .planning/ files.

## User Setup Required

None - no external service configuration required.

## Next Phase Readiness

âœ… **Ready for Phase 02.1 Plan 02** (Force Push to Remote)
- Unified repository structure is complete
- All chezmoi files are in ~/.dotfiles/
- .planning/ history is preserved in unified git history
- Chezmoi is configured and working with new source location
- Age encryption verified working with relocated key

**Note:** The old chezmoi source at ~/.local/share/chezmoi can now be removed (will be handled in Plan 02 cleanup). The backup key at ~/key.txt should be kept until Plan 02 verifies everything works after force push.

---
*Phase: 02.1-repository-consolidation*
*Completed: 2026-02-10*
