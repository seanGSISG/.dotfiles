---
phase: 04-tool-configs
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - .chezmoi.toml.tmpl
  - dot_gitconfig.tmpl
autonomous: true

must_haves:
  truths:
    - "Developer can run git commands with cleaned-up .gitconfig that uses chezmoi templates for name/email"
    - "No hardcoded /home/vscode paths in gitconfig"
    - "gh credential helper preserved for GitHub authentication"
  artifacts:
    - path: "dot_gitconfig.tmpl"
      provides: "Templated git configuration with chezmoi variables"
      contains: "{{ .git_name }}"
    - path: ".chezmoi.toml.tmpl"
      provides: "Chezmoi template with git_name, git_email, editor variables"
      contains: "git_name"
  key_links:
    - from: "dot_gitconfig.tmpl"
      to: ".chezmoi.toml.tmpl"
      via: "chezmoi template variables (git_name, git_email, editor)"
      pattern: '\{\{ \.git_name'
---

<objective>
Create a templated git configuration and add git-specific variables to the chezmoi data section.

Purpose: Satisfy CONF-02 (chezmoi template for git user-specific values) and CONF-03 (no hardcoded paths). The existing `~/.gitconfig` has hardcoded name/email and a coderabbit machine ID that should be dropped. The gh credential helper must be preserved.
Output: `dot_gitconfig.tmpl` with chezmoi template variables, updated `.chezmoi.toml.tmpl` with git_name/git_email/editor in [data] section.
</objective>

<execution_context>
@/home/vscode/.claude/get-shit-done/workflows/execute-plan.md
@/home/vscode/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/04-tool-configs/04-RESEARCH.md

Existing chezmoi template (needs git variables added):
@.chezmoi.toml.tmpl

Current gitconfig on machine (`~/.gitconfig`):
```
[credential "https://github.com"]
	helper =
	helper = !/usr/bin/gh auth git-credential
[credential "https://gist.github.com"]
	helper =
	helper = !/usr/bin/gh auth git-credential
[user]
	name = seanGSISG
	email = sswanson@gsisg.com
[coderabbit]
	machineId = cli/ecea91197d424f19a6b3158a66784562
[gtr "ai"]
	default = claude
```
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add git variables to chezmoi template and create dot_gitconfig.tmpl</name>
  <files>.chezmoi.toml.tmpl, dot_gitconfig.tmpl</files>
  <action>
    **Step 1: Update `.chezmoi.toml.tmpl`**

    Add `git_name`, `git_email`, and `editor` to the existing `[data]` section. Use the current user's actual values as defaults (these will be prompted on new machine init):

    ```toml
    [data]
    hostname = "{{ .chezmoi.hostname }}"
    username = "{{ .chezmoi.username }}"
    git_name = "seanGSISG"
    git_email = "sswanson@gsisg.com"
    editor = "code --wait"
    ```

    Do NOT change any other part of the file (sourceDir, encryption, [age] section).

    **Step 2: Create `dot_gitconfig.tmpl`**

    Create a clean, templated git config that:
    - Uses `{{ .git_name | quote }}` and `{{ .git_email | quote }}` for user section
    - Preserves the gh credential helper for both github.com and gist.github.com
    - Uses `{{ .editor | default "code --wait" | quote }}` for core.editor
    - Adds modern git defaults: `init.defaultBranch = main`, `pull.rebase = false`, `push.autoSetupRemote = true`, `core.autocrlf = input`
    - Does NOT include the [coderabbit] section (machine-specific, not portable)
    - Does NOT include the [gtr "ai"] section (tool-specific, not portable)
    - No hardcoded /home/vscode paths anywhere (CONF-03)

    **Step 3: Run `chezmoi apply` and verify**

    Apply the config and verify the deployed `~/.gitconfig` has correct values. Run `git config user.name` and `git config user.email` to confirm.
  </action>
  <verify>
    1. `chezmoi cat dot_gitconfig.tmpl` shows template syntax ({{ .git_name }}) not literal values
    2. `chezmoi apply --dry-run --verbose 2>&1 | grep -i gitconfig` shows the file will be applied
    3. After `chezmoi apply`: `git config user.name` returns "seanGSISG"
    4. After `chezmoi apply`: `git config user.email` returns "sswanson@gsisg.com"
    5. `grep -r "/home/vscode" ~/.dotfiles/dot_gitconfig.tmpl` returns nothing (CONF-03)
    6. `grep "gh auth" ~/.gitconfig` confirms credential helper preserved
  </verify>
  <done>
    - dot_gitconfig.tmpl exists with chezmoi template variables for name, email, editor
    - .chezmoi.toml.tmpl [data] section contains git_name, git_email, editor
    - Deployed ~/.gitconfig uses correct values from chezmoi data
    - No hardcoded paths in any file
    - gh credential helper intact
  </done>
</task>

</tasks>

<verification>
1. `chezmoi verify` passes without errors
2. `git config user.name` and `git config user.email` return expected values
3. `git config credential.helper` shows gh auth helper
4. `grep -r "/home/vscode" ~/.dotfiles/dot_gitconfig.tmpl ~/.dotfiles/.chezmoi.toml.tmpl` returns nothing
5. Template syntax present in source: `grep "git_name" ~/.dotfiles/dot_gitconfig.tmpl`
</verification>

<success_criteria>
- dot_gitconfig.tmpl deployed via chezmoi produces working ~/.gitconfig
- chezmoi template variables (git_name, git_email, editor) are in [data] section
- No hardcoded usernames or paths (CONF-03)
- gh credential helper preserved for GitHub authentication
- git commands work normally after apply
</success_criteria>

<output>
After completion, create `.planning/phases/04-tool-configs/04-01-SUMMARY.md`
</output>
