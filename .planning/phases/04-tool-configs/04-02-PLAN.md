---
phase: 04-tool-configs
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - dot_config/tmux/tmux.conf
  - dot_config/starship.toml
  - .chezmoiexternal.toml
autonomous: true

must_haves:
  truths:
    - "Developer can launch tmux with cleaned-up configuration using XDG-compliant path"
    - "Developer sees Starship prompt showing git branch/status, virtualenv, node version, command duration"
    - "Starship theme is visually comparable or better than current Powerlevel10k Pure-style setup"
    - "TPM is auto-cloned by chezmoi for tmux plugin management"
  artifacts:
    - path: "dot_config/tmux/tmux.conf"
      provides: "Modern tmux config with TPM, Dracula theme, mouse support, XDG paths"
      contains: "tmux-plugins/tpm"
    - path: "dot_config/starship.toml"
      provides: "Starship prompt config with git, python, nodejs, cmd_duration modules"
      contains: "[git_branch]"
    - path: ".chezmoiexternal.toml"
      provides: "Auto-clone TPM via chezmoi external resources"
      contains: "tmux-plugins/tpm"
  key_links:
    - from: "dot_config/tmux/tmux.conf"
      to: ".chezmoiexternal.toml"
      via: "TPM run command references path that chezmoiexternal clones to"
      pattern: "plugins/tpm/tpm"
    - from: "dot_config/starship.toml"
      to: "dot_zshrc.tmpl"
      via: "zshrc sources starship init which reads starship.toml"
      pattern: "starship init"
---

<objective>
Create tmux configuration with XDG-compliant path and TPM auto-install, plus Starship prompt configuration matching P10k Pure aesthetic.

Purpose: Satisfy CONF-01 (tmux cleaned up), CONF-03 (no hardcoded paths), STAR-01 (Starship configured), STAR-02 (shows git/virtualenv/node/duration), STAR-03 (visually comparable to P10k). Phase 3 shell configs already source Starship conditionally — this plan creates the actual config files.
Output: `dot_config/tmux/tmux.conf`, `dot_config/starship.toml`, `.chezmoiexternal.toml` for TPM.
</objective>

<execution_context>
@/home/vscode/.claude/get-shit-done/workflows/execute-plan.md
@/home/vscode/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/04-tool-configs/04-RESEARCH.md

Current tmux config on machine (`~/.tmux.conf`):
```
# Enable mouse
set -g mouse on

# Increase scrollback buffer
set -g history-limit 50000

# Enable activity alerts
setw -g monitor-activity on
set -g visual-activity on

# Copy paste
set -g @plugin 'tmux-plugins/tmux-yank'
set -g @yank_action 'copy-pipe-and-cancel'
bind -T copy-mode C-c send -X copy-pipe-no-clear "xsel -i --clipboard"
bind -T copy-mode-vi C-c send -X copy-pipe-no-clear "xsel -i --clipboard"

# Reload config file easily
bind r source-file ~/.tmux.conf \; display "Config reloaded!"

# List of plugins
set -g @plugin 'tmux-plugins/tpm'
set -g @plugin 'tmux-plugins/tmux-sensible'
set -g @plugin 'dracula/tmux'
set -g @dracula-plugins "battery"
set -g @dracula-show-left-icon session
set -g @dracula-show-timezone false

# Initialize TMUX plugin manager (keep this line at the very bottom of tmux.conf)
run '~/.tmux/plugins/tpm/tpm'
```

Existing chezmoi source structure in dot_config/:
```
dot_config/
└── zsh/
    ├── aliases/
    ├── exports.zsh
    ├── functions.zsh
    ├── plugins.zsh
    ├── private_dot_zsh_plugins.txt
    ├── tools.zsh
    └── wsl.zsh.tmpl
```

Starship is already sourced conditionally in dot_zshrc.tmpl (line 37-39):
```
if command -v starship &>/dev/null; then
  eval "$(starship init zsh)"
fi
```

Existing .chezmoiignore (may need .chezmoiexternal.toml excluded if chezmoi handles it automatically):
@.chezmoiignore
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create tmux config and TPM external resource</name>
  <files>dot_config/tmux/tmux.conf, .chezmoiexternal.toml</files>
  <action>
    **Step 1: Create directory `dot_config/tmux/` in chezmoi source**

    ```bash
    mkdir -p ~/.dotfiles/dot_config/tmux
    ```

    **Step 2: Create `dot_config/tmux/tmux.conf`**

    Create a cleaned-up tmux config based on the current `~/.tmux.conf` with these improvements:
    - XDG-compliant paths: `~/.config/tmux/` instead of `~/.tmux/`
    - Reload bind uses new path: `bind r source-file ~/.config/tmux/tmux.conf \; display "Config reloaded!"`
    - TPM run path updated: `run '~/.config/tmux/plugins/tpm/tpm'`
    - Add window/pane numbering from 1 (base-index 1, pane-base-index 1)
    - Add renumber-windows on
    - Add intuitive split bindings: `|` for horizontal, `-` for vertical, using current path
    - Keep all existing features: mouse, 50k scrollback, activity alerts, tmux-yank, Dracula theme
    - Keep tmux-yank plugin declaration BEFORE its config lines (current ordering has @plugin after yank config — fix this)
    - Organize into clear sections with comments: General, Window/Pane, Key Bindings, Copy/Paste, Plugins, Theme, TPM Init
    - No hardcoded /home/vscode paths (CONF-03)
    - Use `~` (tilde) for all home-relative paths — tmux resolves `~` correctly

    **Step 3: Create `.chezmoiexternal.toml`**

    Create at repo root (`~/.dotfiles/.chezmoiexternal.toml`) to auto-clone TPM:

    ```toml
    [".config/tmux/plugins/tpm"]
        type = "git-repo"
        url = "https://github.com/tmux-plugins/tpm"
        refreshPeriod = "168h"
    ```

    This tells chezmoi to clone TPM into `~/.config/tmux/plugins/tpm` on `chezmoi apply`.

    **Step 4: Run `chezmoi apply` and verify tmux config deployed**

    Verify `~/.config/tmux/tmux.conf` exists and has correct content. Verify TPM was cloned to `~/.config/tmux/plugins/tpm/`.
  </action>
  <verify>
    1. `cat ~/.config/tmux/tmux.conf` shows the new config with XDG paths
    2. `grep -r "/home/vscode" ~/.dotfiles/dot_config/tmux/` returns nothing (CONF-03)
    3. `grep "~/.config/tmux" ~/.config/tmux/tmux.conf` shows XDG paths used
    4. `ls ~/.config/tmux/plugins/tpm/tpm` confirms TPM was auto-cloned by chezmoi
    5. `cat ~/.dotfiles/.chezmoiexternal.toml` shows TPM git-repo config
  </verify>
  <done>
    - dot_config/tmux/tmux.conf exists with cleaned-up, XDG-compliant tmux config
    - .chezmoiexternal.toml auto-clones TPM on chezmoi apply
    - TPM directory exists at ~/.config/tmux/plugins/tpm/
    - No hardcoded paths anywhere
    - All existing tmux features preserved (mouse, yank, Dracula theme)
  </done>
</task>

<task type="auto">
  <name>Task 2: Create Starship prompt configuration</name>
  <files>dot_config/starship.toml</files>
  <action>
    **Step 1: Create `dot_config/starship.toml`**

    Create Starship config matching P10k Pure aesthetic (clean, minimal, informative). Use the research-verified config from 04-RESEARCH.md as the base with these modules:

    **Format string** (controls what appears and order):
    - directory, git_branch, git_status, python, nodejs, cmd_duration, line_break, character
    - Two-line prompt: info on line 1, input character on line 2

    **Required modules (STAR-02):**
    1. `[character]` — Pure-style `❯` symbol: magenta on success, red on error
    2. `[directory]` — Bold blue, truncate to 3 levels, truncate to repo root
    3. `[git_branch]` — Bold cyan, show branch name, truncate long names at 20 chars
    4. `[git_status]` — Bold red, show modified/staged/untracked/ahead/behind/diverged indicators
    5. `[python]` — Dimmed yellow, show virtualenv name only (not Python version — too noisy)
    6. `[nodejs]` — Bold green, show version when in node project (detect via package.json, .nvmrc, .node-version)
    7. `[cmd_duration]` — Bold yellow, show only when >= 5 seconds (matches P10k default threshold)

    **Disabled modules** (reduce noise):
    - `[package]` disabled = true (version noise in every project)
    - `[time]` disabled = true (visible in terminal title bar)

    **Style guidelines (STAR-03 - match P10k Pure):**
    - Minimal symbols (no powerline glyphs needed)
    - Clean spacing between modules
    - Nerd Font icons for git (branch icon), python, node
    - Two-line layout for breathing room
    - Muted colors for context (python), bold for important (directory, git status)

    **No hardcoded paths** (CONF-03). Starship.toml uses no absolute paths by nature.

    **Step 2: Run `chezmoi apply` and verify**

    Apply and confirm `~/.config/starship.toml` is deployed. If Starship is not installed yet, that's OK — the config file should exist regardless (Phase 5 bootstrap handles installation). Verify with `starship explain` if starship is available.
  </action>
  <verify>
    1. `cat ~/.config/starship.toml` shows the Starship config
    2. Config contains `[git_branch]`, `[git_status]`, `[python]`, `[nodejs]`, `[cmd_duration]` sections
    3. Config contains `[character]` with success_symbol and error_symbol
    4. `grep "disabled = true" ~/.config/starship.toml` shows package and time disabled
    5. `grep -r "/home/vscode" ~/.dotfiles/dot_config/starship.toml` returns nothing (CONF-03)
    6. If starship available: `starship explain` runs without errors
  </verify>
  <done>
    - dot_config/starship.toml exists with P10k Pure-style Starship config
    - All required modules configured: git_branch, git_status, python, nodejs, cmd_duration
    - Character module shows ❯ with color feedback (magenta/red)
    - Noisy modules disabled (package, time)
    - Config deployed to ~/.config/starship.toml
    - Visually matches or exceeds P10k Pure aesthetic (STAR-03)
  </done>
</task>

</tasks>

<verification>
1. `chezmoi verify` passes without errors
2. `ls ~/.config/tmux/tmux.conf ~/.config/starship.toml ~/.config/tmux/plugins/tpm/tpm` — all three paths exist
3. `grep -r "/home/vscode" ~/.dotfiles/dot_config/tmux/ ~/.dotfiles/dot_config/starship.toml ~/.dotfiles/.chezmoiexternal.toml` returns nothing
4. `grep "tpm" ~/.config/tmux/tmux.conf` shows TPM plugin manager
5. `grep "git_branch" ~/.config/starship.toml` shows git module configured
6. If starship available: new shell shows prompt with git info in a git directory
</verification>

<success_criteria>
- tmux config cleaned up, XDG-compliant, deployed to ~/.config/tmux/tmux.conf
- TPM auto-cloned via .chezmoiexternal.toml
- Starship config shows git branch/status, virtualenv, node version, cmd_duration
- Starship theme matches P10k Pure style (minimal, clean, informative)
- No hardcoded /home/vscode paths in any file (CONF-03)
- All existing tmux features preserved
</success_criteria>

<output>
After completion, create `.planning/phases/04-tool-configs/04-02-SUMMARY.md`
</output>
