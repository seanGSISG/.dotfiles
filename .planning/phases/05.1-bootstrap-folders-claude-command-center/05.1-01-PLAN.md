---
phase: 05.1-bootstrap-folders-claude-command-center
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - bootstrap.sh
  - .chezmoiignore
  - command-center/CLAUDE.md.tmpl
  - projects/CLAUDE.md.tmpl
  - labs/CLAUDE.md.tmpl
  - tools/CLAUDE.md.tmpl
  - tmp/CLAUDE.md.tmpl
  - command-center/.keep
  - projects/.keep
  - labs/.keep
  - tools/.keep
  - tmp/.keep
autonomous: true

must_haves:
  truths:
    - "chezmoi apply creates ~/projects/, ~/labs/, ~/tools/, ~/tmp/, ~/command-center/ directories"
    - "Each workspace folder has a CLAUDE.md boundary file after chezmoi apply"
    - "command-center CLAUDE.md describes full workspace structure and learning system"
    - "Bootstrap.sh installs Claude Code via official installer (not bun/npm)"
    - "~/.claude/insights/ is excluded from chezmoi management"
  artifacts:
    - path: "command-center/CLAUDE.md.tmpl"
      provides: "Command center boundary file with workspace map and learning system docs"
      min_lines: 20
    - path: "projects/CLAUDE.md.tmpl"
      provides: "Projects workspace boundary file"
      min_lines: 10
    - path: "labs/CLAUDE.md.tmpl"
      provides: "Labs workspace boundary file"
      min_lines: 10
    - path: "tools/CLAUDE.md.tmpl"
      provides: "Tools workspace boundary file"
      min_lines: 10
    - path: "tmp/CLAUDE.md.tmpl"
      provides: "Tmp workspace boundary file"
      min_lines: 8
    - path: "bootstrap.sh"
      provides: "Updated Claude Code installation using official installer"
      contains: "claude.ai/install.sh"
    - path: ".chezmoiignore"
      provides: "Updated ignore list excluding insights directory"
      contains: ".claude/insights"
  key_links:
    - from: "bootstrap.sh"
      to: "Claude Code binary"
      via: "curl -fsSL https://claude.ai/install.sh | bash"
      pattern: "claude\\.ai/install\\.sh"
    - from: ".chezmoiignore"
      to: "runtime data exclusion"
      via: "ignore pattern"
      pattern: "\\.claude/insights"
---

<objective>
Create chezmoi-managed workspace folder structure with CLAUDE.md boundary files and update bootstrap.sh to use the official Claude Code installer.

Purpose: Establishes the reproducible home directory workspace layout (~/projects/, ~/labs/, ~/tools/, ~/tmp/, ~/command-center/) with scope-defining CLAUDE.md files in each, and fixes the Claude Code installation method to use Anthropic's official installer instead of bun/npm.

Output: 5 workspace folder templates with CLAUDE.md boundary files, updated bootstrap.sh, updated .chezmoiignore
</objective>

<execution_context>
@/home/vscode/.claude/get-shit-done/workflows/execute-plan.md
@/home/vscode/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/05.1-bootstrap-folders-claude-command-center/05.1-CONTEXT.md
@.planning/phases/05.1-bootstrap-folders-claude-command-center/05.1-RESEARCH.md
@bootstrap.sh
@.chezmoiignore
@.chezmoi.toml.tmpl
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create workspace folder templates with CLAUDE.md boundary files</name>
  <files>
    command-center/CLAUDE.md.tmpl
    command-center/.keep
    projects/CLAUDE.md.tmpl
    projects/.keep
    labs/CLAUDE.md.tmpl
    labs/.keep
    tools/CLAUDE.md.tmpl
    tools/.keep
    tmp/CLAUDE.md.tmpl
    tmp/.keep
    .chezmoiignore
  </files>
  <action>
Create 5 workspace folder templates in the chezmoi source directory (~/.dotfiles/). Each folder needs a CLAUDE.md.tmpl and a .keep file (so chezmoi creates the directory even if empty).

IMPORTANT: These are TOP-LEVEL directories in the chezmoi source (NOT inside dot_config/). chezmoi maps source directory names directly to target names. So `~/.dotfiles/projects/` -> `~/projects/`, `~/.dotfiles/command-center/` -> `~/command-center/`, etc.

For each workspace folder, create:

1. **~/projects/CLAUDE.md** — Active development projects boundary file
   - Title: "Projects Workspace"
   - Description: Active development projects and code repositories
   - Allowed: Read/write files, create repos, install deps, run tests
   - Safety: Never store secrets, don't modify outside ~/projects without permission

2. **~/labs/CLAUDE.md** — Experiments boundary file
   - Title: "Labs Workspace"
   - Description: Experiments, tutorials, PoCs, throwaway prototypes
   - Allowed: Read/write files, create experiments freely, install anything
   - Safety: Code here is disposable, but never store secrets

3. **~/tools/CLAUDE.md** — Personal utilities boundary file
   - Title: "Tools Workspace"
   - Description: Personal scripts, helper CLIs, developer utilities
   - Allowed: Read/write files, create CLI tools, manage scripts
   - Safety: Tools should be self-contained, never store secrets

4. **~/tmp/CLAUDE.md** — Scratch space boundary file
   - Title: "Temporary Workspace"
   - Description: Disposable scratch space, safe to wipe anytime
   - Allowed: Full read/write, no restrictions on content
   - Safety: Nothing here is permanent, safe to delete everything

5. **~/command-center/CLAUDE.md** — THE primary CLAUDE.md (most detailed)
   - Title: "Agent Command Center"
   - Description: Primary workspace for Claude Code sessions and development orchestration
   - Include full workspace map showing all 5 folders with descriptions
   - Include learning system section: observations at ~/.claude/insights/observations.jsonl, instincts at ~/.claude/insights/instincts/personal/, mention /instinct-status and /evolve commands
   - Include scope of access: list all workspace folders Claude can operate within
   - Safety rules: never touch secrets/credentials/tokens/private keys, never modify files outside workspace without permission, never delete user files without confirmation
   - Footer: "Managed by chezmoi from ~/.dotfiles/command-center/CLAUDE.md.tmpl"

Use chezmoi template syntax where the username is needed. Use `{{ .chezmoi.homeDir }}` for home directory references in paths if needed. Keep CLAUDE.md files practical, not verbose.

Also create a `.keep` file in each directory (empty file, just ensures chezmoi creates the directory).

Update `.chezmoiignore` to add these entries:
- `.claude/insights/` and `.claude/insights/**` (runtime learning data, never managed by chezmoi)

Do NOT add create_ prefix to the workspace directories — these CLAUDE.md files should always sync from chezmoi source (they're templates, not user-customized config).
  </action>
  <verify>
    Run: `ls -la ~/.dotfiles/projects/ ~/.dotfiles/labs/ ~/.dotfiles/tools/ ~/.dotfiles/tmp/ ~/.dotfiles/command-center/`
    Verify each directory contains CLAUDE.md.tmpl and .keep
    Run: `chezmoi diff` to preview what would be applied
    Run: `grep -c 'insights' ~/.dotfiles/.chezmoiignore` should show matches
  </verify>
  <done>
    5 workspace folder templates exist in chezmoi source, each with CLAUDE.md.tmpl and .keep.
    command-center CLAUDE.md is the most detailed with workspace map and learning system docs.
    .chezmoiignore excludes .claude/insights/ from management.
    `chezmoi diff` shows the 5 new directories would be created under ~/ with their CLAUDE.md files.
  </done>
</task>

<task type="auto">
  <name>Task 2: Update bootstrap.sh Claude Code installation to use official installer</name>
  <files>bootstrap.sh</files>
  <action>
Modify the `install_claude_code()` function in bootstrap.sh to use the official Anthropic installer instead of bun/npm.

Current implementation (REPLACE):
```bash
install_claude_code() {
  # ... uses bun install -g @anthropic-ai/claude-code or npm install -g
}
```

New implementation:
```bash
install_claude_code() {
  if command -v claude &>/dev/null; then
    log_skip "Claude Code already installed"
    SKIPPED+=("Claude Code")
    return 0
  fi

  log_info "Installing Claude Code via official installer..."
  if curl -fsSL https://claude.ai/install.sh | bash >/dev/null 2>&1; then
    log_success "Claude Code installed"
    INSTALLED+=("Claude Code")
  else
    log_error "Claude Code installation failed"
    FAILED_STEPS+=("Claude Code")
    return 1
  fi
}
```

Key changes:
- Remove the bun/npm installation logic entirely
- Use `curl -fsSL https://claude.ai/install.sh | bash` (official Anthropic installer)
- Keep the idempotency check (`command -v claude`)
- Keep the same error handling pattern (log_error + FAILED_STEPS)

Also update the `install_node_tools()` function: The `install_claude_code` call should be moved OUT of `install_node_tools()` because Claude Code no longer depends on Node.js/fnm. Instead, call it as a standalone step in `main()`.

In main(), add a new `run_step` call for Claude Code BEFORE the chezmoi step (so Claude Code is installed first, then chezmoi apply deploys ~/.claude/ configs after — per user decision in CONTEXT.md):

```bash
# In main(), reorder:
run_step "Binary Tools" install_binary_tools
run_step "Plugin Managers" install_plugin_managers
run_step "Python Tools" install_python_tools
run_step "Node.js Tools" install_node_tools
run_step "Claude Code" install_claude_code          # NEW: standalone, before chezmoi
run_step "Dotfile Backup" backup_dotfiles
run_step "Chezmoi Configuration" setup_chezmoi
```

Remove the `install_claude_code` call from inside `install_node_tools()`.
  </action>
  <verify>
    Run: `grep -n 'claude.ai/install.sh' ~/.dotfiles/bootstrap.sh` — should find the official installer URL
    Run: `grep -n 'bun install.*claude' ~/.dotfiles/bootstrap.sh` — should find NOTHING (old method removed)
    Run: `grep -n 'npm install.*claude' ~/.dotfiles/bootstrap.sh` — should find NOTHING (old method removed)
    Run: `grep -n 'run_step.*Claude Code' ~/.dotfiles/bootstrap.sh` — should show standalone step
    Run: `bash -n ~/.dotfiles/bootstrap.sh` — syntax check passes (exit code 0)
  </verify>
  <done>
    bootstrap.sh uses official Claude Code installer (curl -fsSL https://claude.ai/install.sh | bash).
    Claude Code installation is a standalone step, not nested inside install_node_tools().
    Claude Code step runs before chezmoi apply in main() execution order.
    Old bun/npm installation code is completely removed.
    Script passes bash syntax check.
  </done>
</task>

</tasks>

<verification>
1. `chezmoi diff` shows 5 workspace directories with CLAUDE.md files would be created
2. `bash -n bootstrap.sh` passes with no syntax errors
3. `grep 'claude.ai/install.sh' bootstrap.sh` confirms official installer
4. `grep 'insights' .chezmoiignore` confirms runtime data exclusion
5. Each CLAUDE.md.tmpl is valid chezmoi template syntax
</verification>

<success_criteria>
- 5 workspace folder templates exist in chezmoi source with CLAUDE.md boundary files
- command-center CLAUDE.md contains workspace map, learning system docs, and safety rules
- bootstrap.sh uses official Claude Code installer, Claude Code step is standalone before chezmoi
- .chezmoiignore excludes ~/.claude/insights/ from management
- All files pass syntax checks
</success_criteria>

<output>
After completion, create `.planning/phases/05.1-bootstrap-folders-claude-command-center/05.1-01-SUMMARY.md`
</output>
