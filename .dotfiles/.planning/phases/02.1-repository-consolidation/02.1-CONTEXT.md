# Phase 2.1: Repository Consolidation - Context

**Gathered:** 2026-02-10
**Status:** Ready for planning

<domain>
## Phase Boundary

Consolidate the split repo structure into a single `~/.dotfiles` directory — move chezmoi source from `~/.local/share/chezmoi` to `~/.dotfiles`, merge the `.planning/` files into the same repo, clean up the accidental home-directory git repo, and push unified history to GitHub.

</domain>

<decisions>
## Implementation Decisions

### History preservation
- Merge both git histories (chezmoi repo + home repo) with a merge commit at the unification point
- Chezmoi repo is the primary repo (keeps its commit hashes unchanged)
- Home repo's 20 `.planning/` commits merge in via merge commit
- Merge commit clearly marks the unification point
- Same GitHub remote, force push the unified history

### Home repo cleanup
- Home repo (`~/`) only tracks `.planning/` files — nothing else to rescue
- Delete `~/.git` after merge is complete (no archive needed)
- Delete orphaned `~/.planning/` directory (superseded by `~/.dotfiles/.planning/`)

### Post-migration layout
- `.planning/` stays at repo root (`~/.dotfiles/.planning/`)
- Package lists (apt-packages.txt, uv-tools.txt, binary-installs.txt) move to `~/.dotfiles/packages/` subdirectory
- Age encryption key moves from `~/key.txt` to `~/.config/age/keys.txt` (standard XDG location), update chezmoi config to point there
- Final layout:
  ```
  ~/.dotfiles/
  ├── .chezmoi.toml.tmpl
  ├── .chezmoiignore
  ├── .git/
  ├── .gitignore
  ├── .planning/
  ├── .pre-commit-config.yaml
  ├── .secrets.baseline
  ├── .secrets.env.example
  ├── README.md
  ├── encrypted_dot_secrets.env.age
  └── packages/
  ```

### Post-migration cleanup
- Delete `~/.local/share/chezmoi` entirely (no symlink)
- Delete without pre-verification; resolve issues if they arise
- Keep `~/.dotfiles-backup/` and other Phase 1-2 artifacts until project completion
- Force push unified history to GitHub as final step of this phase

### Claude's Discretion
- Exact git merge strategy (subtree merge, remote add, etc.)
- .chezmoiignore updates for new paths
- Order of operations during migration
- Conflict resolution approach during history merge

</decisions>

<specifics>
## Specific Ideas

- The two path prefixes in the home repo history (`.planning/` and `.dotfiles/.planning/`) should resolve cleanly — final state is `.planning/` at repo root
- `chezmoi source-path` must return `~/.dotfiles` after migration (success criterion #1)

</specifics>

<deferred>
## Deferred Ideas

None — discussion stayed within phase scope

</deferred>

---

*Phase: 02.1-repository-consolidation*
*Context gathered: 2026-02-10*
